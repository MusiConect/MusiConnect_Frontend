import{a as G}from"./chunk-4BBUEBG6.js";import{a as $}from"./chunk-JCNJBNNY.js";import{a as L}from"./chunk-XITNKEX4.js";import{a as D}from"./chunk-7OC2QND7.js";import{b as T,c as I,d as k,e as A,h as N,i as R,j as V,q as M,s as O}from"./chunk-TKQ7GRMY.js";import{a as j}from"./chunk-Q4PFRBFB.js";import{Aa as y,Ba as C,F as o,Fa as F,I as _,K as S,O as p,Oa as E,R as l,T as w,U as r,V as a,W as h,Z as v,da as b,ea as c,ga as s,ha as u,ia as g,l as B,u as f,v as x}from"./chunk-H2FOQYQS.js";function H(i,t){i&1&&h(0,"app-band-sidebar")}function q(i,t){i&1&&(r(0,"div",19),s(1,"Cargando..."),a())}function P(i,t){i&1&&(r(0,"div",20),s(1,"No administras ninguna banda."),a())}function z(i,t){if(i&1){let e=v();r(0,"li",23)(1,"div")(2,"h3",24),b("click",function(){let d=f(e).$implicit,m=c(3);return x(m.viewBand(d.bandId))}),s(3),a(),r(4,"p",25),s(5),a()(),r(6,"div",26)(7,"button",27),b("click",function(){let d=f(e).$implicit,m=c(3);return x(m.editBand(d.bandId))}),s(8,"Editar"),a(),r(9,"button",28),b("click",function(){let d=f(e).$implicit,m=c(3);return x(m.deleteBand(d.bandId))}),s(10,"Eliminar"),a()()()}if(i&2){let e=t.$implicit;o(3),u(e.nombre),o(2),u(e.descripcion)}}function J(i,t){if(i&1&&(r(0,"ul",21),p(1,z,11,2,"li",22),a()),i&2){let e=c(2);o(),l("ngForOf",e.myBands)}}function K(i,t){if(i&1&&(r(0,"div",17)(1,"h2",6),s(2,"Tus Bandas"),a(),p(3,q,2,0,"div",18)(4,P,2,0,"div",15)(5,J,2,1,"ul",16),a()),i&2){let e=c();o(3),l("ngIf",e.isLoading),o(),l("ngIf",!e.isLoading&&e.myBands.length===0),o(),l("ngIf",!e.isLoading&&e.myBands.length>0)}}function Q(i,t){i&1&&(r(0,"div",29),s(1,"Buscando..."),a())}function W(i,t){if(i&1){let e=v();r(0,"div",30)(1,"h3",24),b("click",function(){f(e);let d=c();return x(d.viewBand(d.searchedBand.bandId))}),s(2),a(),r(3,"p",25),s(4),a(),r(5,"p",31),s(6),a()()}if(i&2){let e=c();o(2),u(e.searchedBand.nombre),o(2),u(e.searchedBand.descripcion),o(2),g("Administrador: ",e.searchedBand.administradorNombreArtistico,"")}}function X(i,t){if(i&1&&(r(0,"div",32),s(1),a()),i&2){let e=c();o(),g(" ",e.searchError," ")}}function Y(i,t){i&1&&(r(0,"div",20),s(1,"Sin bandas existentes"),a())}function Z(i,t){if(i&1&&(r(0,"span"),s(1),a()),i&2){let e=c(3);w(e.tipoMensaje==="success"?"text-xs text-green-600 font-medium px-2 py-0.5 bg-green-100 rounded-md":"text-xs text-red-600 font-medium px-2 py-0.5 bg-red-100 rounded-md"),o(),g(" ",e.mensajeAccion," ")}}function ee(i,t){if(i&1){let e=v();r(0,"li",34)(1,"div")(2,"h3",24),b("click",function(){let d=f(e).$implicit,m=c(2);return x(m.viewBand(d.bandId))}),s(3),a(),r(4,"p",35),s(5),a(),r(6,"p",36),s(7,"Administrador: "),r(8,"span",37),s(9),a()(),r(10,"p",36),s(11,"G\xE9nero: "),r(12,"span",37),s(13),a()()(),r(14,"div",38)(15,"button",39),b("click",function(){let d=f(e).$implicit,m=c(2);return x(m.toggleFollow(d))}),h(16,"img",40),a(),p(17,Z,2,3,"span",41),a()()}if(i&2){let e=t.$implicit,n=c(2);o(3),u(e.nombre),o(2),u(e.descripcion),o(4),u(e.administradorNombreArtistico),o(4),u(e.generosMusicales.join(", ")),o(4),l("ngIf",n.accionBandId===e.bandId&&n.mensajeAccion)}}function te(i,t){if(i&1&&(r(0,"ul",21),p(1,ee,18,5,"li",33),a()),i&2){let e=c();o(),l("ngForOf",e.otherBands)}}var U=class i{constructor(t,e,n,d,m){this.fb=t;this.bandService=e;this.followService=n;this.sessionService=d;this.router=m}myBands=[];otherBands=[];isLoading=!0;searchForm;searchedBand=null;isSearching=!1;searchError="";followedBandIds=new Set;mensajeAccion="";tipoMensaje="success";accionBandId=null;ngOnInit(){this.loadMyBands(),this.loadFollowedBands(),this.searchForm=this.fb.group({bandName:["",[I.required,I.minLength(2)]]})}loadMyBands(){this.isLoading=!0;let t=this.sessionService.getNombreArtistico();this.bandService.obtenerBandas().pipe(B(()=>this.isLoading=!1)).subscribe({next:e=>{this.myBands=e.filter(n=>n.administradorNombreArtistico===t),this.otherBands=e.filter(n=>n.administradorNombreArtistico!==t)},error:()=>{}})}loadFollowedBands(){let t=this.sessionService.getUserId();t&&this.followService.listarPerfilesSeguidos(t).subscribe({next:e=>{let n=e.filter(d=>d.tipo==="Banda").map(d=>d.id);this.followedBandIds=new Set(n)},error:()=>{}})}toggleFollow(t){let e=this.sessionService.getUserId();if(!e){this.tipoMensaje="error",this.mensajeAccion="Debe iniciar sesi\xF3n.",this.accionBandId=t.bandId,setTimeout(()=>this.mensajeAccion="",3e3);return}if(this.followedBandIds.has(t.bandId)){let n={followerId:e,followedBandId:t.bandId};this.followService.eliminarFollow(n).subscribe({next:()=>{this.followedBandIds.delete(t.bandId),this.tipoMensaje="error",this.mensajeAccion=`Has dejado de seguir a ${t.nombre}.`,this.accionBandId=t.bandId,setTimeout(()=>this.mensajeAccion="",3e3)},error:()=>{this.tipoMensaje="error",this.mensajeAccion="Error al dejar de seguir la banda.",this.accionBandId=t.bandId,setTimeout(()=>this.mensajeAccion="",3e3)}})}else{let n={followerId:e,followedBandId:t.bandId};this.followService.crearFollow(n).subscribe({next:()=>{this.followedBandIds.add(t.bandId),this.tipoMensaje="success",this.mensajeAccion=`Ahora sigues a ${t.nombre}.`,this.accionBandId=t.bandId,setTimeout(()=>this.mensajeAccion="",3e3)},error:()=>{this.tipoMensaje="error",this.mensajeAccion="Error al seguir la banda.",this.accionBandId=t.bandId,setTimeout(()=>this.mensajeAccion="",3e3)}})}}searchByName(){if(this.searchForm.invalid)return;this.isSearching=!0,this.searchedBand=null,this.searchError="";let t=this.searchForm.value.bandName.trim().toLowerCase();this.bandService.obtenerBandas().pipe(B(()=>this.isSearching=!1)).subscribe({next:e=>{let n=e.find(d=>d.nombre.toLowerCase()===t);n?this.searchedBand=n:this.searchError=`No se encontr\xF3 ninguna banda con el nombre "${this.searchForm.value.bandName}".`},error:()=>{this.searchError="Error al buscar la banda."}})}editBand(t){this.router.navigate(["/editar-banda",t])}deleteBand(t){let e=this.sessionService.getUserId();if(!e){this.tipoMensaje="error",this.mensajeAccion="Error de autenticaci\xF3n.",this.accionBandId=null,setTimeout(()=>this.mensajeAccion="",3e3);return}confirm("\xBFEst\xE1s seguro de que deseas eliminar esta banda?")&&this.bandService.eliminarBanda(t,e).subscribe({next:()=>{this.myBands=this.myBands.filter(n=>n.bandId!==t)},error:n=>{this.tipoMensaje="error",this.mensajeAccion=n.error?.message||"Error al eliminar la banda.",this.accionBandId=t,setTimeout(()=>this.mensajeAccion="",3e3)}})}viewBand(t){this.router.navigate(["/mostrar-banda",t])}static \u0275fac=function(e){return new(e||i)(_(M),_($),_(D),_(j),_(E))};static \u0275cmp=S({type:i,selectors:[["app-listar-bandas"]],decls:21,vars:9,consts:[[1,"flex","h-screen","bg-gray-100"],[4,"appHasRole"],[1,"flex-1","p-10","overflow-y-auto"],[1,"max-w-4xl","mx-auto"],["class","bg-[#F1EFEF] border-2 border-black p-6 rounded-2xl shadow-2xl mb-8",4,"appHasRole"],[1,"bg-[#F1EFEF]","border-2","border-black","p-6","rounded-2xl","shadow-2xl"],[1,"text-2xl","font-bold","mb-4"],[3,"ngSubmit","formGroup"],[1,"flex","space-x-2"],["type","text","formControlName","bandName","placeholder","Ingrese el nombre de la banda",1,"flex-grow","px-4","py-2","border-2","border-black","rounded-lg"],["type","submit",1,"bg-[#FF8DFF]","text-black","font-bold","px-6","py-2","rounded-lg","hover:opacity-90","disabled:bg-gray-300","disabled:cursor-not-allowed",3,"disabled"],["class","text-center mt-4",4,"ngIf"],["class","mt-4 p-4 border rounded-lg",4,"ngIf"],["class","mt-4 text-center text-red-600",4,"ngIf"],[1,"bg-[#F1EFEF]","border-2","border-black","p-6","rounded-2xl","shadow-2xl","mt-8"],["class","text-center text-gray-500",4,"ngIf"],["class","space-y-3",4,"ngIf"],[1,"bg-[#F1EFEF]","border-2","border-black","p-6","rounded-2xl","shadow-2xl","mb-8"],["class","text-center",4,"ngIf"],[1,"text-center"],[1,"text-center","text-gray-500"],[1,"space-y-3"],["class","p-4 border-2 border-black rounded-lg flex justify-between items-center",4,"ngFor","ngForOf"],[1,"p-4","border-2","border-black","rounded-lg","flex","justify-between","items-center"],["aria-label","Ver detalles de la banda",1,"font-bold","text-lg","cursor-pointer","hover:underline",3,"click"],[1,"text-sm","text-gray-600"],[1,"space-x-2"],[1,"bg-[#FF8DFF]","text-black","px-3","py-1","rounded-md","hover:opacity-90",3,"click"],[1,"bg-[#000784]","text-white","px-3","py-1","rounded-md","hover:opacity-90",3,"click"],[1,"text-center","mt-4"],[1,"mt-4","p-4","border","rounded-lg"],[1,"text-sm","text-gray-500","mt-1"],[1,"mt-4","text-center","text-red-600"],["class","p-4 border-2 border-black rounded-lg bg-white flex justify-between items-start",4,"ngFor","ngForOf"],[1,"p-4","border-2","border-black","rounded-lg","bg-white","flex","justify-between","items-start"],[1,"text-sm"],[1,"text-sm","font-bold"],[1,"font-normal"],[1,"flex","flex-col","items-center","gap-1","ml-4"],["aria-label","Seguir o dejar de seguir banda",1,"flex-shrink-0",3,"click"],["src","/Follow.png","alt","Icono seguir","width","50","height","50"],[3,"class",4,"ngIf"]],template:function(e,n){e&1&&(r(0,"div",0),p(1,H,1,0,"app-band-sidebar",1),r(2,"div",2)(3,"div",3),p(4,K,6,3,"div",4),r(5,"div",5)(6,"h2",6),s(7,"Buscar Banda por nombre"),a(),r(8,"form",7),b("ngSubmit",function(){return n.searchByName()}),r(9,"div",8),h(10,"input",9),r(11,"button",10),s(12,"Buscar"),a()()(),p(13,Q,2,0,"div",11)(14,W,7,3,"div",12)(15,X,2,1,"div",13),a(),r(16,"div",14)(17,"h2",6),s(18,"Todas las bandas:"),a(),p(19,Y,2,0,"div",15)(20,te,2,1,"ul",16),a()()()()),e&2&&(o(),l("appHasRole","PRODUCTOR"),o(3),l("appHasRole","PRODUCTOR"),o(4),l("formGroup",n.searchForm),o(3),l("disabled",n.searchForm.invalid),o(2),l("ngIf",n.isSearching),o(),l("ngIf",n.searchedBand),o(),l("ngIf",n.searchError),o(4),l("ngIf",n.otherBands.length===0),o(),l("ngIf",n.otherBands.length>0))},dependencies:[F,y,C,O,N,T,k,A,R,V,G,L],encapsulation:2})};export{U as ListarBandasComponent};
