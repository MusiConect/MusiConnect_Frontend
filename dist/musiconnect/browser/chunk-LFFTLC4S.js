import{a as P}from"./chunk-4BBUEBG6.js";import{a as H}from"./chunk-JCNJBNNY.js";import{a as T}from"./chunk-XITNKEX4.js";import{c as h,d as U,e as B,h as O,i as L,j as D,k as R,l as k,m as w,q as G,s as j}from"./chunk-TKQ7GRMY.js";import{a as A}from"./chunk-FQDNF3NE.js";import{a as N}from"./chunk-Q4PFRBFB.js";import{Aa as F,Ba as y,F as n,Fa as C,I as l,K as S,O as m,Oa as E,R as a,U as s,V as o,W as _,da as M,ea as f,g as v,ga as d,ha as b,ia as I,j as x,k as u,l as g}from"./chunk-H2FOQYQS.js";function q(e,i){e&1&&_(0,"app-band-sidebar")}function $(e,i){if(e&1&&(s(0,"option",17),d(1),o()),e&2){let t=i.$implicit;a("value",t.bandId),n(),b(t.nombre)}}function z(e,i){e&1&&(s(0,"div",18),d(1," Debes seleccionar una banda. "),o())}function J(e,i){if(e&1&&(s(0,"option",17),d(1),o()),e&2){let t=i.$implicit;a("value",t.userId),n(),b(t.nombreArtistico)}}function K(e,i){e&1&&(s(0,"div",18),d(1," Debes seleccionar una persona. "),o())}function Q(e,i){e&1&&(s(0,"div",19),d(1," No hay otros usuarios disponibles para invitar. "),o())}function W(e,i){if(e&1&&(s(0,"div",20),d(1),o()),e&2){let t=f();n(),I(" ",t.errorMessage," ")}}function X(e,i){if(e&1&&(s(0,"div",21),d(1),o()),e&2){let t=f();n(),I(" ",t.successMessage," ")}}function Y(e,i){e&1&&(s(0,"span"),d(1,"Invitar"),o())}function Z(e,i){e&1&&(s(0,"span"),d(1,"Invitando..."),o())}var V=class e{constructor(i,t,r,p,c){this.fb=i;this.bandService=t;this.sessionService=r;this.userService=p;this.router=c}inviteForm;isLoading=!1;errorMessage="";successMessage="";adminBands=[];availableUsers=[];ngOnInit(){this.initForm(),this.loadInitialData()}initForm(){this.inviteForm=this.fb.group({bandId:["",h.required],userId:["",h.required]})}loadInitialData(){this.isLoading=!0;let i=this.sessionService.getUserId(),t=this.sessionService.getNombreArtistico();if(!i||!t){this.errorMessage="No se pudo verificar el administrador.",this.isLoading=!1;return}x({bands:this.bandService.obtenerBandas().pipe(u(r=>(console.error("Error fetching bands:",r),this.errorMessage="Error al cargar tus bandas.",v([])))),users:this.userService.getAll().pipe(u(r=>(console.error("Error fetching users:",r),this.errorMessage=(this.errorMessage?this.errorMessage+" ":"")+"Error al cargar los usuarios.",v([]))))}).pipe(g(()=>this.isLoading=!1)).subscribe({next:({bands:r,users:p})=>{this.adminBands=r.filter(c=>c.administradorNombreArtistico===t),this.availableUsers=p.filter(c=>c.userId!==i),this.availableUsers.length===0?this.inviteForm.get("userId")?.disable():this.inviteForm.get("userId")?.enable()},error:()=>{this.errorMessage="Ocurri\xF3 un error inesperado al cargar los datos.",this.isLoading=!1}})}onSubmit(){if(this.inviteForm.invalid){this.markFormGroupTouched();return}this.isLoading=!0,this.errorMessage="",this.successMessage="";let i=this.sessionService.getUserId();if(!i){this.errorMessage="Error: Usuario no autenticado.",this.isLoading=!1;return}let t=+this.inviteForm.value.bandId,r=+this.inviteForm.value.userId;this.bandService.addMiembro(t,{userId:r,adminId:i}).pipe(g(()=>this.isLoading=!1)).subscribe({next:()=>{this.successMessage="\xA1Invitaci\xF3n enviada exitosamente!",this.inviteForm.reset(),setTimeout(()=>{this.successMessage=""},3e3)},error:p=>{this.errorMessage=p.error?.message||"Error al enviar la invitaci\xF3n. Int\xE9ntalo de nuevo."}})}isInvalid(i){let t=this.inviteForm.get(i);return!!t&&t.invalid&&t.touched}markFormGroupTouched(){Object.values(this.inviteForm.controls).forEach(i=>{i.markAsTouched()})}static \u0275fac=function(t){return new(t||e)(l(G),l(H),l(N),l(A),l(E))};static \u0275cmp=S({type:e,selectors:[["app-invitar-miembro"]],decls:25,vars:12,consts:[[1,"flex","h-screen","bg-gray-100"],[4,"appHasRole"],[1,"flex-1","p-10","flex","justify-center","items-start"],[1,"bg-[#F1EFEF]","border-2","border-black","p-8","rounded-2xl","shadow-2xl","w-full","max-w-2xl","mx-auto"],[3,"ngSubmit","formGroup"],[1,"space-y-8"],["formControlName","bandId",1,"w-full","px-4","py-3","border-2","border-black","rounded-lg","text-gray-700","focus:outline-none","focus:ring-2","focus:ring-pink-400"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["class","mt-1 text-red-600 text-sm",4,"ngIf"],["formControlName","userId",1,"w-full","px-4","py-3","border-2","border-black","rounded-lg","text-gray-700","focus:outline-none","focus:ring-2","focus:ring-pink-400"],["class","mt-1 text-gray-500 text-sm",4,"ngIf"],["class","mt-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg text-center",4,"ngIf"],["class","mt-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg text-center",4,"ngIf"],[1,"mt-8","text-center"],["type","submit",1,"bg-[#FF8DFF]","text-black","font-bold","py-3","px-12","rounded-lg","shadow-lg","hover:opacity-90","disabled:bg-gray-300","disabled:cursor-not-allowed",3,"disabled"],[4,"ngIf"],[3,"value"],[1,"mt-1","text-red-600","text-sm"],[1,"mt-1","text-gray-500","text-sm"],[1,"mt-6","bg-red-100","border","border-red-400","text-red-700","px-4","py-3","rounded-lg","text-center"],[1,"mt-6","bg-green-100","border","border-green-400","text-green-700","px-4","py-3","rounded-lg","text-center"]],template:function(t,r){t&1&&(s(0,"div",0),m(1,q,1,0,"app-band-sidebar",1),s(2,"div",2)(3,"div",3)(4,"form",4),M("ngSubmit",function(){return r.onSubmit()}),s(5,"div",5)(6,"div")(7,"select",6)(8,"option",7),d(9,"Tus Bandas"),o(),m(10,$,2,2,"option",8),o(),m(11,z,2,0,"div",9),o(),s(12,"div")(13,"select",10)(14,"option",7),d(15,"Invitar a Personas"),o(),m(16,J,2,2,"option",8),o(),m(17,K,2,0,"div",9)(18,Q,2,0,"div",11),o()(),m(19,W,2,1,"div",12)(20,X,2,1,"div",13),s(21,"div",14)(22,"button",15),m(23,Y,2,0,"span",16)(24,Z,2,0,"span",16),o()()()()()()),t&2&&(n(),a("appHasRole","PRODUCTOR"),n(3),a("formGroup",r.inviteForm),n(6),a("ngForOf",r.adminBands),n(),a("ngIf",r.isInvalid("bandId")),n(5),a("ngForOf",r.availableUsers),n(),a("ngIf",r.isInvalid("userId")),n(),a("ngIf",!r.isLoading&&r.availableUsers.length===0),n(),a("ngIf",r.errorMessage),n(),a("ngIf",r.successMessage),n(2),a("disabled",r.isLoading||!r.inviteForm.valid||r.availableUsers.length===0),n(),a("ngIf",!r.isLoading),n(),a("ngIf",r.isLoading))},dependencies:[C,F,y,j,O,k,w,R,U,B,L,D,P,T],encapsulation:2})};export{V as InvitarMiembroComponent};
