import{a as q}from"./chunk-4BBUEBG6.js";import{a as G}from"./chunk-JCNJBNNY.js";import{a as F}from"./chunk-2B52NTL2.js";import{a as k}from"./chunk-PAUB4K2N.js";import{a as E}from"./chunk-XITNKEX4.js";import{b as B,c,d as N,e as O,h as T,i as M,j as A,k as L,l as R,m as P,q as U,s as D}from"./chunk-TKQ7GRMY.js";import{a as y}from"./chunk-Q4PFRBFB.js";import{Aa as S,Ba as h,F as i,Fa as I,I as p,K as v,O as m,Oa as _,R as s,U as o,V as a,W as f,da as x,ea as u,ga as d,ha as C,ia as g,l as b}from"./chunk-H2FOQYQS.js";function V(r,t){r&1&&f(0,"app-band-sidebar")}function z(r,t){if(r&1&&(o(0,"div",19),d(1),a()),r&2){let e=u();i(),g(" ",e.getFieldError("nombre")," ")}}function Y(r,t){if(r&1&&(o(0,"div",20),d(1),a()),r&2){let e=u();i(),g(" ",e.getFieldError("descripcion")," ")}}function Z(r,t){if(r&1&&(o(0,"option",21),d(1),a()),r&2){let e=t.$implicit;s("value",e),i(),C(e)}}function J(r,t){if(r&1&&(o(0,"div",22),d(1),a()),r&2){let e=u();i(),g(" ",e.getFieldError("genero")," ")}}function X(r,t){if(r&1&&(o(0,"div",23),d(1),a()),r&2){let e=u();i(),g(" ",e.errorMessage," ")}}function Q(r,t){if(r&1&&(o(0,"div",24),d(1),a()),r&2){let e=u();i(),g(" ",e.successMessage," ")}}function W(r,t){r&1&&(o(0,"span"),d(1,"Crear Banda"),a())}function ee(r,t){r&1&&(o(0,"span"),d(1,"Creando..."),a())}var w=class r{constructor(t,e,n,l,j,H){this.fb=t;this.bandService=e;this.sessionService=n;this.router=l;this.notifications=j;this.postService=H}bandForm;isLoading=!1;errorMessage="";successMessage="";generosMusicales=["ROCK","POP","JAZZ","CLASSICAL","HIP_HOP","REGGAETON","BLUES","ELECTRONIC","FOLK","LATIN","COUNTRY","METAL","RNB","SOUL","PUNK","DISCO","FUNK","SALSA","CUMBIA","BACHATA","K_POP","OPERA","SOUNDTRACK","SAYA","CAPORAL","INDIE","OTHER"];ngOnInit(){this.initForm()}initForm(){this.bandForm=this.fb.group({nombre:["",[c.required,c.minLength(4),c.maxLength(50)]],descripcion:["",[c.required,c.minLength(10),c.maxLength(500)]],genero:["",c.required]})}onSubmit(){if(this.bandForm.valid){this.isLoading=!0,this.errorMessage="",this.successMessage="";let t=this.sessionService.getUserId();if(!t){this.errorMessage="Error: Usuario no autenticado",this.isLoading=!1;return}let e=this.bandForm.value,n={nombre:e.nombre,descripcion:e.descripcion,generos:[e.genero],adminId:t};this.bandService.crearBanda(n).pipe(b(()=>this.isLoading=!1)).subscribe({next:l=>{this.successMessage=`\xA1Banda "${l.nombre}" creada exitosamente!`,this.notifications.push("Creaci\xF3n de tu banda puesta en publicaciones!","SUCCESS");let $=`${this.sessionService.getNombreArtistico()??"Alguien"} ha creado una banda llamada <a href='/mostrar-banda/${l.bandId}' class='text-blue-600 underline'>${l.nombre}</a> \xA1vayan a darle un vistaso si desean!`,K=this.sessionService.getUserId()??0;this.postService.crearPost({usuarioId:K,contenido:$,tipo:"TEXTO"}).subscribe({next:()=>{},error:()=>{}}),setTimeout(()=>{this.router.navigate(["/bandas"])},2e3)},error:l=>{this.errorMessage=l.error?.message||"Error al crear la banda. Int\xE9ntalo de nuevo."}})}else this.markFormGroupTouched()}markFormGroupTouched(){Object.values(this.bandForm.controls).forEach(t=>{t.markAsTouched()})}getFieldError(t){let e=this.bandForm.get(t);if(e?.errors&&e.touched){if(e.errors.required)return"Este campo es obligatorio";if(e.errors.minlength)return`M\xEDnimo ${e.errors.minlength.requiredLength} caracteres`;if(e.errors.maxlength)return`M\xE1ximo ${e.errors.maxlength.requiredLength} caracteres`}return""}cancelar(){this.router.navigate(["/bandas"])}static \u0275fac=function(e){return new(e||r)(p(U),p(G),p(y),p(_),p(F),p(k))};static \u0275cmp=v({type:r,selectors:[["app-crear-banda"]],decls:24,vars:11,consts:[[1,"flex","h-screen","bg-gray-100"],[4,"appHasRole"],[1,"flex-1","p-10"],[1,"bg-[#F1EFEF]","border-2","border-black","p-8","rounded-2xl","shadow-2xl","max-w-2xl","mx-auto"],[3,"ngSubmit","formGroup"],[1,"space-y-8"],["id","nombre","type","text","formControlName","nombre","placeholder","Nombre de la Banda...","aria-describedby","nombre-error",1,"w-full","px-4","py-3","border-2","border-black","rounded-lg","text-gray-700","focus:outline-none","focus:ring-2","focus:ring-pink-400"],["id","nombre-error","class","mt-1 text-red-600 text-sm",4,"ngIf"],["id","descripcion","formControlName","descripcion","rows","4","placeholder","Descripcion/Objetivo...","aria-describedby","descripcion-error",1,"w-full","px-4","py-3","border-2","border-black","rounded-lg","text-gray-700","focus:outline-none","focus:ring-2","focus:ring-pink-400","resize-none"],["id","descripcion-error","class","mt-1 text-red-600 text-sm",4,"ngIf"],["id","genero","formControlName","genero","aria-describedby","genero-error",1,"w-full","px-4","py-3","border-2","border-black","rounded-lg","text-gray-700","focus:outline-none","focus:ring-2","focus:ring-pink-400"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["id","genero-error","class","mt-1 text-red-600 text-sm",4,"ngIf"],["class","mt-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg",4,"ngIf"],["class","mt-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg",4,"ngIf"],[1,"mt-8","text-center"],["type","submit",1,"bg-[#FF8DFF]","text-black","font-bold","py-3","px-12","rounded-lg","shadow-lg","hover:opacity-90","disabled:bg-gray-300","disabled:cursor-not-allowed",3,"disabled"],[4,"ngIf"],["id","nombre-error",1,"mt-1","text-red-600","text-sm"],["id","descripcion-error",1,"mt-1","text-red-600","text-sm"],[3,"value"],["id","genero-error",1,"mt-1","text-red-600","text-sm"],[1,"mt-6","bg-red-100","border","border-red-400","text-red-700","px-4","py-3","rounded-lg"],[1,"mt-6","bg-green-100","border","border-green-400","text-green-700","px-4","py-3","rounded-lg"]],template:function(e,n){e&1&&(o(0,"div",0),m(1,V,1,0,"app-band-sidebar",1),o(2,"div",2)(3,"div",3)(4,"form",4),x("ngSubmit",function(){return n.onSubmit()}),o(5,"div",5)(6,"div"),f(7,"input",6),m(8,z,2,1,"div",7),a(),o(9,"div"),f(10,"textarea",8),m(11,Y,2,1,"div",9),a(),o(12,"div")(13,"select",10)(14,"option",11),d(15,"Generos Musicales"),a(),m(16,Z,2,2,"option",12),a(),m(17,J,2,1,"div",13),a()(),m(18,X,2,1,"div",14)(19,Q,2,1,"div",15),o(20,"div",16)(21,"button",17),m(22,W,2,0,"span",18)(23,ee,2,0,"span",18),a()()()()()()),e&2&&(i(),s("appHasRole","PRODUCTOR"),i(3),s("formGroup",n.bandForm),i(4),s("ngIf",n.getFieldError("nombre")),i(3),s("ngIf",n.getFieldError("descripcion")),i(5),s("ngForOf",n.generosMusicales),i(),s("ngIf",n.getFieldError("genero")),i(),s("ngIf",n.errorMessage),i(),s("ngIf",n.successMessage),i(2),s("disabled",n.isLoading||!n.bandForm.valid),i(),s("ngIf",!n.isLoading),i(),s("ngIf",n.isLoading))},dependencies:[I,S,h,D,T,R,P,B,L,N,O,M,A,q,E],encapsulation:2})};export{w as CrearBandaComponent};
