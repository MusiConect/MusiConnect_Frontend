import{a as V}from"./chunk-2B52NTL2.js";import{a as z}from"./chunk-PAUB4K2N.js";import{a as G}from"./chunk-ETROT72L.js";import{b as W,d as P,e as k,f as D,g as U,h as q,n as R,o as A,r as B}from"./chunk-TKQ7GRMY.js";import{a as F}from"./chunk-Q4PFRBFB.js";import{Ba as N,F as c,Fa as j,I as m,K as S,O as v,Oa as T,R as p,U as o,V as i,W as _,Z as w,da as M,ea as I,fa as g,ga as s,ia as E,ja as C,ka as h,la as b,u,v as f,za as L}from"./chunk-H2FOQYQS.js";function J(a,l){a&1&&(o(0,"p",20),s(1," El t\xEDtulo es obligatorio y debe tener al menos 3 caracteres. "),i())}function K(a,l){a&1&&(o(0,"p",20),s(1," La descripci\xF3n es obligatoria y debe tener al menos 10 caracteres. "),i())}function Q(a,l){if(a&1&&(o(0,"div",21),s(1),i()),a&2){let r=I();p("ngClass",r.mensaje.startsWith("\u2705")?"text-green-700":"text-red-600"),c(),E(" ",r.mensaje," ")}}var O=class a{constructor(l,r,e,d,n){this.convocationService=l;this.session=r;this.notifications=e;this.postService=d;this.router=n}titulo="";descripcion="";fechaLimite="";mensaje="";publicar(l){if(l.invalid)return;let r={titulo:this.titulo,descripcion:this.descripcion,fechaLimite:this.fechaLimite,usuarioId:this.session.getUserId()??0};this.convocationService.crearConvocatoria(r).subscribe({next:e=>{this.mensaje="\u2705 \xA1Convocatoria publicada con \xE9xito!",this.notifications.push("Creaci\xF3n de tu convocatoria puesta en publicaciones!","SUCCESS");let n=e.body?.convocationId??e.body?.convocatoriaId??e.body?.id;if(!n){let x=e.headers.get("Location")??e.headers.get("location");if(x){let y=x.match(/\/(\d+)$/);y&&(n=+y[1])}}n=n||0;let X=`${this.session.getNombreArtistico()??"Alguien"} ha creado una convocatoria llamada <a href='/mostrar-convocatoria/${n}' class='text-blue-600 underline'>${this.titulo}</a> \xA1vayan a darle un vistaso si desean!`,H=this.session.getUserId()??0;this.postService.crearPost({usuarioId:H,contenido:X,tipo:"TEXTO"}).subscribe(),this.titulo="",this.descripcion="",this.fechaLimite="",l.resetForm(),setTimeout(()=>{this.mensaje="",this.router.navigate(["/listar-convocatorias"])},2e3)},error:e=>{this.mensaje=e.error?.message?`\u274C ${e.error.message}`:"\u274C Error al publicar la convocatoria",setTimeout(()=>this.mensaje="",2e3)}})}static \u0275fac=function(r){return new(r||a)(m(G),m(F),m(V),m(z),m(T))};static \u0275cmp=S({type:a,selectors:[["app-crear-convocatoria"]],decls:29,vars:7,consts:[["form","ngForm"],["tituloCtrl","ngModel"],["descCtrl","ngModel"],["fechaCtrl","ngModel"],[1,"max-w-7xl","mx-auto","px-6","py-12","grid","grid-cols-1","md:grid-cols-3","gap-8","font-bree"],[1,"md:col-span-2","space-y-10"],[1,"text-4xl","leading-tight","font-black"],["novalidate","",1,"space-y-8",3,"ngSubmit"],["for","titulo",1,"block","mb-2","text-2xl"],["type","text","id","titulo","name","titulo","minlength","3","required","",1,"w-full","max-w-none","md:max-w-[1424px]","border","border-black","rounded","px-4","py-3","text-xl",3,"ngModelChange","ngModel"],["class","text-red-600 text-sm mt-1",4,"ngIf"],["for","descripcion",1,"block","mb-2","text-2xl"],["id","descripcion","name","descripcion","minlength","10","required","",1,"w-full","max-w-none","md:max-w-[1424px]","border","border-black","rounded","px-4","py-3","text-xl","h-40","resize-none",3,"ngModelChange","ngModel"],["for","fechaLimite",1,"block","mb-2","text-2xl"],["type","date","id","fechaLimite","name","fechaLimite","required","",1,"w-64","border","border-black","rounded","px-4","py-3","text-xl",3,"ngModelChange","ngModel"],[1,"pt-4","text-center"],["type","submit",1,"w-full","md:w-[1172px]","h-[88px]","bg-[#ff04fc]","hover:opacity-90","text-white","text-3xl","font-bold","rounded-[15px]","transition-opacity","disabled:bg-gray-300","disabled:cursor-not-allowed",3,"disabled"],["class","text-center text-lg font-semibold mt-6",3,"ngClass",4,"ngIf"],[1,"hidden","md:flex","justify-center","items-start"],["src","/Megafono.png","alt","Meg\xE1fono convocatoria",1,"w-64"],[1,"text-red-600","text-sm","mt-1"],[1,"text-center","text-lg","font-semibold","mt-6",3,"ngClass"]],template:function(r,e){if(r&1){let d=w();o(0,"div",4)(1,"div",5)(2,"h1",6),s(3,"Crear nueva convocatoria"),i(),o(4,"form",7,0),M("ngSubmit",function(){u(d);let t=g(5);return f(e.publicar(t))}),o(6,"div")(7,"label",8),s(8,"Titulo para la convocatoria"),i(),o(9,"input",9,1),b("ngModelChange",function(t){return u(d),h(e.titulo,t)||(e.titulo=t),f(t)}),i(),v(11,J,2,0,"p",10),i(),o(12,"div")(13,"label",11),s(14,"Descripci\xF3n"),i(),o(15,"textarea",12,2),b("ngModelChange",function(t){return u(d),h(e.descripcion,t)||(e.descripcion=t),f(t)}),i(),v(17,K,2,0,"p",10),i(),o(18,"div")(19,"label",13),s(20,"Fecha limite de la convocatoria"),i(),o(21,"input",14,3),b("ngModelChange",function(t){return u(d),h(e.fechaLimite,t)||(e.fechaLimite=t),f(t)}),i()(),o(23,"div",15)(24,"button",16),s(25," Publicar Convocatoria "),i()()(),v(26,Q,2,2,"div",17),i(),o(27,"div",18),_(28,"img",19),i()()}if(r&2){let d=g(5),n=g(10),t=g(16);c(9),C("ngModel",e.titulo),c(2),p("ngIf",n.invalid&&n.touched),c(4),C("ngModel",e.descripcion),c(2),p("ngIf",t.invalid&&t.touched),c(4),C("ngModel",e.fechaLimite),c(3),p("disabled",d.invalid),c(2),p("ngIf",e.mensaje)}},dependencies:[j,L,N,B,q,W,P,k,R,A,U,D],encapsulation:2})};export{O as CrearConvocatoriaComponent};
