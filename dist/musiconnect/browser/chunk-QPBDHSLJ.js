import{a as j}from"./chunk-4BBUEBG6.js";import{a as q}from"./chunk-JCNJBNNY.js";import{a as k}from"./chunk-XITNKEX4.js";import{b as R,c as u,d as T,e as N,h as w,i as D,j as L,k as O,l as G,m as A,q as z,s as V}from"./chunk-TKQ7GRMY.js";import{a as M}from"./chunk-Q4PFRBFB.js";import{Aa as I,Ba as F,F as r,Fa as C,I as c,K as h,Ma as y,O as l,Oa as B,R as a,U as o,V as n,W as b,Z as E,da as S,ea as m,ga as d,ha as x,ia as p,l as f,u as v,v as _}from"./chunk-H2FOQYQS.js";function P(t,i){t&1&&b(0,"app-band-sidebar")}function U(t,i){if(t&1&&(o(0,"div",24),d(1),n()),t&2){let e=m(2);r(),p(" ",e.getFieldError("nombre")," ")}}function $(t,i){if(t&1&&(o(0,"option",25),d(1),n()),t&2){let e=i.$implicit;a("value",e),r(),x(e)}}function J(t,i){if(t&1&&(o(0,"div",24),d(1),n()),t&2){let e=m(2);r(),p(" ",e.getFieldError("genero")," ")}}function W(t,i){if(t&1&&(o(0,"div",26),d(1),n()),t&2){let e=m(2);r(),p(" ",e.errorMessage," ")}}function K(t,i){if(t&1&&(o(0,"div",27),d(1),n()),t&2){let e=m(2);r(),p(" ",e.successMessage," ")}}function Q(t,i){t&1&&(o(0,"span"),d(1,"Actualizar Banda"),n())}function X(t,i){t&1&&(o(0,"span"),d(1,"Actualizando..."),n())}function Y(t,i){if(t&1){let e=E();o(0,"div",6)(1,"h2",7),d(2),n(),o(3,"form",8),S("ngSubmit",function(){v(e);let g=m();return _(g.onSubmit())}),o(4,"div",9)(5,"div")(6,"label",10),d(7,"Nombre de la Banda"),n(),b(8,"input",11),l(9,U,2,1,"div",12),n(),o(10,"div")(11,"label",13),d(12,"Descripci\xF3n (Opcional)"),n(),b(13,"textarea",14),n(),o(14,"div")(15,"label",15),d(16,"G\xE9nero Musical"),n(),o(17,"select",16)(18,"option",17),d(19,"Selecciona un g\xE9nero"),n(),l(20,$,2,2,"option",18),n(),l(21,J,2,1,"div",12),n()(),l(22,W,2,1,"div",19)(23,K,2,1,"div",20),o(24,"div",21)(25,"button",22),l(26,Q,2,0,"span",23)(27,X,2,0,"span",23),n()()()()}if(t&2){let e=m();r(2),p("Actualizar Banda: ",e.band.nombre,""),r(),a("formGroup",e.editForm),r(6),a("ngIf",e.getFieldError("nombre")),r(11),a("ngForOf",e.generosMusicales),r(),a("ngIf",e.getFieldError("genero")),r(),a("ngIf",e.errorMessage),r(),a("ngIf",e.successMessage),r(2),a("disabled",e.isSubmitting||!e.editForm.valid),r(),a("ngIf",!e.isSubmitting),r(),a("ngIf",e.isSubmitting)}}function Z(t,i){t&1&&(o(0,"div",28)(1,"p"),d(2,"Cargando datos de la banda..."),n()())}function ee(t,i){if(t&1&&(o(0,"div",29)(1,"p"),d(2),n()()),t&2){let e=m();r(2),x(e.errorMessage)}}var H=class t{constructor(i,e,s,g,te){this.fb=i;this.bandService=e;this.sessionService=s;this.route=g;this.router=te}editForm;isLoading=!0;isSubmitting=!1;errorMessage="";successMessage="";band=null;bandId=null;generosMusicales=["Rock","Pop","Jazz","Blues","Country","Hip Hop","R&B","Electronic","Folk","Reggae","Punk","Metal","Indie","Alternative","Classical","Funk","Soul","Gospel","Latin","World Music"];ngOnInit(){this.initForm(),this.route.paramMap.subscribe(i=>{let e=i.get("id");e?(this.bandId=+e,this.loadBandData()):(this.isLoading=!1,this.errorMessage="No se proporcion\xF3 un ID de banda.")})}initForm(){this.editForm=this.fb.group({nombre:["",[u.required,u.minLength(4),u.maxLength(50)]],descripcion:[""],genero:["",u.required]})}loadBandData(){this.bandId&&(this.isLoading=!0,this.bandService.obtenerBandaPorId(this.bandId).pipe(f(()=>this.isLoading=!1)).subscribe({next:i=>{this.band=i;let e=i.generosMusicales&&i.generosMusicales.length>0?i.generosMusicales[0]:"";this.editForm.setValue({nombre:i.nombre,descripcion:i.descripcion||"",genero:e})},error:()=>{this.errorMessage="Error al cargar los datos de la banda."}}))}onSubmit(){if(this.editForm.invalid){this.markFormGroupTouched();return}let i=this.sessionService.getUserId();if(!i||!this.bandId){this.errorMessage="No se pudo verificar la autenticaci\xF3n o el ID de la banda.";return}this.isSubmitting=!0,this.errorMessage="",this.successMessage="";let e=this.editForm.value,s={nombre:e.nombre,descripcion:e.descripcion,generos:[e.genero],adminId:i};this.bandService.updateBanda(this.bandId,s).pipe(f(()=>this.isSubmitting=!1)).subscribe({next:()=>{this.successMessage="\xA1Banda actualizada exitosamente!",setTimeout(()=>this.router.navigate(["/bandas"]),2e3)},error:g=>{this.errorMessage=g.error?.message||"Error al actualizar la banda."}})}getFieldError(i){let e=this.editForm.get(i);if(e?.errors&&e.touched){if(e.errors.required)return"Este campo es obligatorio.";if(e.errors.minlength)return`M\xEDnimo ${e.errors.minlength.requiredLength} caracteres.`;if(e.errors.maxlength)return`M\xE1ximo ${e.errors.maxlength.requiredLength} caracteres.`}return""}markFormGroupTouched(){Object.values(this.editForm.controls).forEach(i=>{i.markAsTouched()})}static \u0275fac=function(e){return new(e||t)(c(z),c(q),c(M),c(y),c(B))};static \u0275cmp=h({type:t,selectors:[["app-editar-banda"]],decls:6,vars:4,consts:[[1,"flex","h-screen","bg-gray-100"],[4,"appHasRole"],[1,"flex-1","p-10"],["class","bg-[#F1EFEF] border-2 border-black p-8 rounded-2xl shadow-2xl max-w-2xl mx-auto",4,"ngIf"],["class","text-center",4,"ngIf"],["class","text-center text-red-600",4,"ngIf"],[1,"bg-[#F1EFEF]","border-2","border-black","p-8","rounded-2xl","shadow-2xl","max-w-2xl","mx-auto"],[1,"text-2xl","font-bold","text-center","mb-8"],[3,"ngSubmit","formGroup"],[1,"space-y-8"],["for","nombre",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","nombre","type","text","formControlName","nombre",1,"w-full","px-4","py-3","border-2","border-black","rounded-lg","text-gray-700","focus:outline-none","focus:ring-2","focus:ring-pink-400"],["class","mt-1 text-red-600 text-sm",4,"ngIf"],["for","descripcion",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","descripcion","formControlName","descripcion","rows","4",1,"w-full","px-4","py-3","border-2","border-black","rounded-lg","text-gray-700","focus:outline-none","focus:ring-2","focus:ring-pink-400","resize-none"],["for","genero",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","genero","formControlName","genero",1,"w-full","px-4","py-3","border-2","border-black","rounded-lg","text-gray-700","focus:outline-none","focus:ring-2","focus:ring-pink-400"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],["class","mt-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg text-center",4,"ngIf"],["class","mt-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg text-center",4,"ngIf"],[1,"mt-8","text-center"],["type","submit",1,"bg-pink-300","text-black","font-bold","py-3","px-12","rounded-lg","shadow-lg","hover:bg-pink-400","disabled:bg-gray-300","disabled:cursor-not-allowed",3,"disabled"],[4,"ngIf"],[1,"mt-1","text-red-600","text-sm"],[3,"value"],[1,"mt-6","bg-red-100","border","border-red-400","text-red-700","px-4","py-3","rounded-lg","text-center"],[1,"mt-6","bg-green-100","border","border-green-400","text-green-700","px-4","py-3","rounded-lg","text-center"],[1,"text-center"],[1,"text-center","text-red-600"]],template:function(e,s){e&1&&(o(0,"div",0),l(1,P,1,0,"app-band-sidebar",1),o(2,"div",2),l(3,Y,28,10,"div",3)(4,Z,3,0,"div",4)(5,ee,3,1,"div",5),n()()),e&2&&(r(),a("appHasRole","PRODUCTOR"),r(2),a("ngIf",!s.isLoading&&s.band),r(),a("ngIf",s.isLoading),r(),a("ngIf",!s.isLoading&&!s.band&&s.errorMessage))},dependencies:[C,I,F,V,w,G,A,R,O,T,N,D,L,j,k],encapsulation:2})};export{H as EditarBandaComponent};
