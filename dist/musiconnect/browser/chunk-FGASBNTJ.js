import{a as j}from"./chunk-XITNKEX4.js";import{a as U}from"./chunk-ETROT72L.js";import{a as N}from"./chunk-Q4PFRBFB.js";import{Aa as O,Ba as k,D as A,Ea as D,F as c,Fa as L,I as b,K as w,O as u,Oa as V,Pa as E,R as l,Sa as R,U as n,V as s,W as I,Z as _,a as h,b as C,da as m,ea as d,ga as p,ha as P,ia as S,pa as y,ra as T,u as g,v as f,za as F}from"./chunk-H2FOQYQS.js";function $(o,t){o&1&&(n(0,"a",14),p(1," Crear convocatoria "),s())}function G(o,t){if(o&1){let e=_();n(0,"img",24),m("click",function(){g(e);let i=d().$implicit,a=d(2);return f(a.toggleFavorito(i))}),s()}if(o&2){let e=d().$implicit;l("src",e.esFavorita?"/Favorita.png":"/NoFavorita.png",A)("alt",e.esFavorita?"Favorita":"No favorita")}}function z(o,t){o&1&&(n(0,"span",25),p(1,"Expirada"),s())}function H(o,t){if(o&1){let e=_();n(0,"div",17),I(1,"img",18),u(2,G,1,2,"img",19),n(3,"div",20)(4,"h2",21),m("click",function(){let i=g(e).$implicit,a=d(2);return f(a.verDetalle(i))}),p(5),s(),n(6,"p",22),p(7),y(8,"date"),u(9,z,2,0,"span",23),s()()()}if(o&2){let e=t.$implicit;c(2),l("ngIf",!e.esPropia&&!e.expirada&&e.activa),c(3),P(e.titulo),c(2),S("",T(8,4,e.fechaLimite,"dd/MM/yyyy")," "),c(2),l("ngIf",e.expirada)}}function B(o,t){if(o&1&&(n(0,"div",15),u(1,H,10,7,"div",16),s()),o&2){let e=d();c(),l("ngForOf",e.convocatoriasPagina)}}function q(o,t){o&1&&(n(0,"div",26),I(1,"img",27),s())}function J(o,t){if(o&1){let e=_();n(0,"button",31),m("click",function(){let i=g(e).$implicit,a=d(2);return f(a.irAPagina(i))}),p(1),s()}if(o&2){let e=t.$implicit,r=d(2);l("ngClass",r.currentPage===e?"bg-[#000784] text-white":"text-[#000784]"),c(),S(" ",e," ")}}function K(o,t){if(o&1){let e=_();n(0,"div",28)(1,"button",29),m("click",function(){g(e);let i=d();return f(i.paginaAnterior())}),p(2," \u2039 "),s(),u(3,J,2,2,"button",30),n(4,"button",29),m("click",function(){g(e);let i=d();return f(i.paginaSiguiente())}),p(5," \u203A "),s()()}if(o&2){let e=d();c(),l("disabled",e.currentPage===1),c(2),l("ngForOf",e.paginas),c(),l("disabled",e.currentPage===e.totalPaginas)}}function Q(o,t){o&1&&(n(0,"div",32),p(1,"Cargando..."),s())}var M=class o{constructor(t,e,r){this.convocationService=t;this.session=e;this.router=r}convocatorias=[];filtro="TODAS";cargando=!1;favoritasIds=new Set;nombreUsuario=null;activasIds=new Set;CONVOCATORIAS_POR_PAGINA=9;currentPage=1;ngOnInit(){this.nombreUsuario=this.session.getNombreArtistico(),this.cargarDatos()}cargarDatos(){this.cargando=!0,this.currentPage=1;let t=this.session.getUserId()??0;if(this.filtro==="FAVORITAS"){this.convocationService.listarFavoritasPorUsuario(t).subscribe({next:r=>{this.favoritasIds=new Set(r.map(i=>i.convocationId)),this.convocatorias=r.map(i=>{let a=this.esExpirada(i.fechaLimite);return C(h({},i),{esFavorita:!0,esPropia:this.nombreUsuario===i.creadorNombreArtistico,expirada:a,activa:!a})}).sort((i,a)=>a.convocationId-i.convocationId),this.convocatorias.filter(i=>i.expirada&&i.esFavorita).forEach(i=>{this.convocationService.eliminarDeFavoritas({usuarioId:t,convocatoriaId:i.convocationId}).subscribe(),i.esFavorita=!1}),this.cargando=!1,this.currentPage=1},error:()=>{this.convocatorias=[],this.cargando=!1}});return}(this.filtro==="ACTIVAS"?this.convocationService.listarActivas():this.convocationService.listarTodas()).subscribe({next:r=>{let i=r;this.convocationService.listarFavoritasPorUsuario(t).subscribe({next:a=>{this.favoritasIds=new Set(a.map(v=>v.convocationId)),this.convocatorias=i.map(v=>{let x=this.esExpirada(v.fechaLimite);return C(h({},v),{esFavorita:this.favoritasIds.has(v.convocationId),esPropia:this.nombreUsuario===v.creadorNombreArtistico,expirada:x,activa:!x})}).sort((v,x)=>x.convocationId-v.convocationId),this.cargando=!1,this.currentPage=1},error:()=>{this.convocatorias=i.map(a=>{let v=this.esExpirada(a.fechaLimite);return C(h({},a),{esFavorita:!1,esPropia:this.nombreUsuario===a.creadorNombreArtistico,expirada:v,activa:!v})}).sort((a,v)=>v.convocationId-a.convocationId),this.cargando=!1,this.currentPage=1}})},error:()=>this.cargando=!1})}verSoloFavoritas(){this.filtro="FAVORITAS",this.cargarDatos()}verSoloActivas(){this.filtro=this.filtro==="ACTIVAS"?"TODAS":"ACTIVAS",this.cargarDatos()}recargar(){this.cargarDatos()}toggleFavorito(t){if(t.esPropia||t.expirada||!t.activa)return;let e=this.session.getUserId()??0;t.esFavorita?this.convocationService.eliminarDeFavoritas({usuarioId:e,convocatoriaId:t.convocationId}).subscribe({next:()=>{t.esFavorita=!1}}):this.convocationService.marcarComoFavorita({usuarioId:e,convocatoriaId:t.convocationId}).subscribe({next:()=>{t.esFavorita=!0}})}verDetalle(t){t.expirada||this.router.navigate(["/mostrar-convocatoria",t.convocationId])}esExpirada(t){return(t.includes("T")?new Date(t):new Date(`${t}T23:59:59`)).getTime()<Date.now()}get totalPaginas(){return Math.max(1,Math.ceil(this.convocatorias.length/this.CONVOCATORIAS_POR_PAGINA))}get paginas(){return Array.from({length:this.totalPaginas},(t,e)=>e+1)}get convocatoriasPagina(){let t=(this.currentPage-1)*this.CONVOCATORIAS_POR_PAGINA;return this.convocatorias.slice(t,t+this.CONVOCATORIAS_POR_PAGINA)}irAPagina(t){t>=1&&t<=this.totalPaginas&&(this.currentPage=t)}paginaAnterior(){this.currentPage>1&&this.currentPage--}paginaSiguiente(){this.currentPage<this.totalPaginas&&this.currentPage++}static \u0275fac=function(e){return new(e||o)(b(U),b(N),b(V))};static \u0275cmp=w({type:o,selectors:[["app-listar-convocatorias"]],decls:19,vars:5,consts:[[1,"max-w-7xl","mx-auto","px-6","py-12","font-bree"],[1,"flex","justify-between","items-center","mb-8"],[1,"text-3xl","font-black"],["routerLink","/crear-convocatoria","class","bg-[#000784] text-white font-bree px-4 py-2 rounded-[15px] hover:bg-[#0005a0] transition-colors",4,"appHasRole"],[1,"flex","flex-col","md:flex-row","md:items-center","md:justify-between","gap-6","mb-8"],[1,"flex","flex-wrap","gap-6"],[1,"border-2","border-black","rounded-[6px]","px-4","py-2","min-w-[350px]","bg-white","hover:bg-gray-100","text-center",3,"click"],[1,"flex","items-center","gap-2","self-start","md:self-auto",3,"click"],["src","/Reload.png","alt","Actualizar",1,"w-6","h-6"],[1,"underline"],["class","grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8",4,"ngIf"],["class","flex justify-center mt-16",4,"ngIf"],["class","flex justify-center mt-8 items-center gap-2 font-bree",4,"ngIf"],["class","text-center text-lg mt-10",4,"ngIf"],["routerLink","/crear-convocatoria",1,"bg-[#000784]","text-white","font-bree","px-4","py-2","rounded-[15px]","hover:bg-[#0005a0]","transition-colors"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-3","gap-8"],["class","w-[254px] h-[281px] bg-[#D9D9D9] p-4 relative",4,"ngFor","ngForOf"],[1,"w-[254px]","h-[281px]","bg-[#D9D9D9]","p-4","relative"],["src","/FotoPerfil.png","alt","Perfil",1,"w-20","h-20","object-cover"],["class","w-8 h-8 absolute top-4 right-4 cursor-pointer",3,"src","alt","click",4,"ngIf"],[1,"absolute","bottom-4","left-4","right-4"],[1,"font-poppins","font-bold","text-lg","break-words","cursor-pointer","hover:underline",3,"click"],[1,"font-poppins","font-bold","text-sm","flex","items-center"],["class","ml-1 px-1 bg-[#c80000] text-white font-bree",4,"ngIf"],[1,"w-8","h-8","absolute","top-4","right-4","cursor-pointer",3,"click","src","alt"],[1,"ml-1","px-1","bg-[#c80000]","text-white","font-bree"],[1,"flex","justify-center","mt-16"],["src","/NoMoreConvos.png","alt","No hay m\xE1s convocatorias",1,"w-64"],[1,"flex","justify-center","mt-8","items-center","gap-2","font-bree"],[1,"px-3","py-1","rounded","hover:bg-gray-200","disabled:bg-gray-300","disabled:cursor-not-allowed",3,"click","disabled"],["class","w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-200",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"w-8","h-8","rounded-full","flex","items-center","justify-center","hover:bg-gray-200",3,"click","ngClass"],[1,"text-center","text-lg","mt-10"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),p(3,"Convocatorias"),s(),u(4,$,2,0,"a",3),s(),n(5,"div",4)(6,"div",5)(7,"button",6),m("click",function(){return r.verSoloFavoritas()}),p(8," Listar solo convocatorias favoritas "),s(),n(9,"button",6),m("click",function(){return r.verSoloActivas()}),p(10," Listar solo convocatorias activas "),s()(),n(11,"button",7),m("click",function(){return r.recargar()}),I(12,"img",8),n(13,"span",9),p(14,"Actualizar"),s()()(),u(15,B,2,1,"div",10)(16,q,2,0,"div",11)(17,K,6,3,"div",12)(18,Q,2,0,"div",13),s()),e&2&&(c(4),l("appHasRole","PRODUCTOR"),c(11),l("ngIf",!r.cargando&&r.convocatorias.length>0),c(),l("ngIf",!r.cargando&&r.convocatorias.length===0),c(),l("ngIf",r.totalPaginas>1&&!r.cargando),c(),l("ngIf",r.cargando))},dependencies:[L,F,O,k,D,R,E,j],encapsulation:2})};export{M as ListarConvocatoriasComponent};
